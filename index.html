<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SheetPilot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1C1C2A;
      color: #f5f2e8;
      padding: 30px;
    }
    h1, h2 {
      color: #f5f2e8;
    }
    select, input[type="text"], input[type="file"], button {
      padding: 10px;
      margin: 5px 0;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      width: 100%;
    }
    .section {
      margin-bottom: 40px;
    }
    .dropdown-label {
      font-weight: bold;
      margin-top: 20px;
    }
    button {
      background-color: #00f7ff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #00d2db;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table th, table td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    table th {
      background-color: #00f7ff;
      color: #000;
    }
  </style>
</head>
<body>
  <h1>SheetPilot</h1>

  <div class="section">
    <label class="dropdown-label">Select Industry</label>
    <select id="industrySelect" onchange="populateSubcategories()">
      <option value="">-- Select Industry --</option>
      <option value="Small Business">Small Business</option>
      <option value="Real Estate">Real Estate</option>
      <option value="Healthcare">Healthcare</option>
      <option value="Education">Education</option>
      <option value="Construction">Construction</option>
      <option value="E-commerce">E-commerce</option>
      <option value="Manufacturing">Manufacturing</option>
      <option value="Logistics">Logistics</option>
      <option value="IT Services">IT Services</option>
      <option value="Marketing">Marketing</option>
      <option value="Finance">Finance</option>
      <option value="Legal">Legal</option>
      <option value="Retail">Retail</option>
      <option value="Hospitality">Hospitality</option>
      <option value="Nonprofit">Nonprofit</option>
      <option value="Government">Government</option>
      <option value="Automotive">Automotive</option>
      <option value="Agriculture">Agriculture</option>
      <option value="Energy">Energy</option>
      <option value="Security">Security</option>
    </select>

    <select id="subcategorySelect">
      <option value="">-- Select Subcategory --</option>
    </select>

    <input type="text" placeholder="Or enter your business type..." id="customIndustryInput" />
  </div>

  <div class="section">
    <label class="dropdown-label">Upload Your File</label>
    <input type="file" id="fileInput" accept=".xlsx" />
  </div>

  <div class="section" id="headerSection" style="display: none;">
    <h2>Label Columns</h2>
    <div id="labelContainer"></div>
    <button onclick="confirmLabels()">Confirm Labels</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const subcategories = {
      "Small Business": ["Lawn Care", "Cleaning Services", "Freelance", "Pet Services", "Handyman", "Tutoring", "Personal Training"],
      "Real Estate": ["Agents", "Property Management", "Appraisers"],
      "Healthcare": ["Clinics", "Private Practice", "Therapists", "Home Care"],
      "Construction": ["General Contracting", "Roofing", "Electrical", "HVAC", "Plumbing"],
      "E-commerce": ["Online Retailer", "Dropshipping", "Handmade Goods"],
      "Education": ["Tutoring", "Test Prep", "Online Courses"],
      "Logistics": ["Trucking", "Courier Services", "Fleet Management"],
      "IT Services": ["Consulting", "Software Support", "Cybersecurity"],
      "Retail": ["Boutique", "Grocery", "Mobile Vendor"],
      "Hospitality": ["Event Planning", "Catering", "Vacation Rentals"],
      "Automotive": ["Detailing", "Repair", "Dealerships"]
    };

    function populateSubcategories() {
      const industry = document.getElementById("industrySelect").value;
      const subSelect = document.getElementById("subcategorySelect");
      subSelect.innerHTML = '<option value="">-- Select Subcategory --</option>';
      if (subcategories[industry]) {
        subcategories[industry].forEach(sc => {
          const opt = document.createElement("option");
          opt.value = sc;
          opt.innerText = sc;
          subSelect.appendChild(opt);
        });
      }
    }

    let rawData = [], headers = [];

    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
        headers = rows[0];
        rawData = rows.slice(1);
        showLabelSelectors(headers);
      };
      reader.readAsArrayBuffer(file);
    });

    function showLabelSelectors(columns) {
      const container = document.getElementById("labelContainer");
      container.innerHTML = '';
      columns.forEach((header, i) => {
        const wrapper = document.createElement("div");
        wrapper.classList.add("section");

        const label = document.createElement("label");
        label.innerText = `Original Column: ${header}`;

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Enter new column label";
        input.dataset.index = i;

        wrapper.appendChild(label);
        wrapper.appendChild(input);
        container.appendChild(wrapper);
      });

      document.getElementById("headerSection").style.display = "block";
    }

    function confirmLabels() {
      const inputs = document.querySelectorAll("#labelContainer input");
      const labels = Array.from(inputs).map(input => ({
        label: input.value.trim(),
        index: parseInt(input.dataset.index)
      })).filter(entry => entry.label);

      const selectedIndices = labels.map(l => l.index);
      const filteredHeaders = labels.map(l => l.label);
      const filteredData = rawData.map(row =>
        labels.map(l => formatValue(row[l.index]))
      );

      displayTable(filteredHeaders, filteredData);
    }

    function formatValue(value) {
      if (typeof value === "string" && Date.parse(value)) {
        const date = new Date(value);
        return date.toLocaleDateString("en-US");
      }
      return value ?? "";
    }

    function displayTable(headers, data) {
      const tableContainer = document.getElementById("headerSection");
      const tableWrapper = document.createElement("div");
      const table = document.createElement("table");

      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.innerText = h;
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);

      const tbody = document.createElement("tbody");
      data.forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.innerText = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      tableWrapper.innerHTML = "<h2>Preview Cleaned Table</h2>";
      tableWrapper.appendChild(table);
      tableContainer.appendChild(tableWrapper);
    }
  </script>
</body>
</ 
