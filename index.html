<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SheetPilot</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1C1C2A;
      color: #f7f1e3;
    }
    header {
      padding: 20px;
      text-align: center;
      font-size: 2.5em;
      font-weight: bold;
      color: #f7f1e3;
      background: #0f0f1a;
    }
    main {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    section {
      margin-bottom: 40px;
    }
    label, select, input {
      display: block;
      margin: 10px 0;
    }
    button {
      background-color: #00FFFF;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin-top: 10px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #003366;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #2a2a3d;
    }
    .row {
      display: flex;
      gap: 20px;
    }
    .column {
      flex: 1;
    }
    .advanced {
      background-color: #2a2a3d;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>SheetPilot</header>
  <main>
    <section id="upload">
      <h2>Upload Your File</h2>
      <input type="file" id="fileInput" />
    </section>

    <section id="industrySelect">
      <h2>Select Your Industry</h2>
      <label for="industry">Industry:</label>
      <select id="industry">
        <option>-- Choose Industry --</option>
        <option>Real Estate</option>
        <option>Construction</option>
        <option>Legal</option>
        <option>Healthcare</option>
        <option>Education</option>
        <option>Retail</option>
        <option>Food Services</option>
        <option>Marketing</option>
        <option>Nonprofit</option>
        <option>Security</option>
        <option>Technology</option>
        <option>Finance</option>
        <option>Transportation</option>
        <option>Hospitality</option>
        <option>Automotive</option>
        <option>Agriculture</option>
        <option>Government</option>
        <option>Entrepreneurship</option>
        <option>Small Business</option>
      </select>

      <label for="subcategory">Subcategory:</label>
      <select id="subcategory">
        <option>-- Choose Subcategory --</option>
        <!-- Dynamically filled -->
      </select>
    </section>

    <section id="headers">
      <h2>Set Column Headers</h2>
      <div id="headerMappingArea"></div>
      <button onclick="previewSheet()">Preview Sheet</button>
    </section>

    <section id="filter">
      <h2>Clean Your Sheet (Optional)</h2>
      <div class="advanced">
        <label>Remove rows where column is blank:</label>
        <select id="removeIfBlankColumn"></select>

        <label>Keep rows where column equals:</label>
        <select id="keepIfColumn"></select>
        <input type="text" id="keepIfValue" placeholder="Value" />

        <label>Sort rows by:</label>
        <select id="sortColumn"></select>
        <select id="sortDirection">
          <option value="asc">A → Z</option>
          <option value="desc">Z → A</option>
        </select>
      </div>
    </section>

    <section id="preview">
      <h2>Preview</h2>
      <div id="tableContainer"></div>
      <button onclick="downloadCSV()">Download CSV</button>
      <button onclick="downloadXLSX()">Download XLSX</button>
    </section>
  </main>

  <script>
    const fileInput = document.getElementById("fileInput");
    const tableContainer = document.getElementById("tableContainer");
    const headerMappingArea = document.getElementById("headerMappingArea");
    const industrySelect = document.getElementById("industry");
    const subcategorySelect = document.getElementById("subcategory");

    let rawData = [];
    let headers = [];

    const subcategories = {
      "Real Estate": ["Residential", "Commercial", "Property Management"],
      "Legal": ["Family Law", "Corporate Law", "Notary", "Criminal Defense"],
      "Small Business": ["Cleaning Services", "Lawn Care", "Tutoring", "Handyman", "Beauty", "Home-Based", "E-commerce"],
      "Healthcare": ["Dentistry", "Chiropractic", "Therapy", "Private Practice"],
      "Marketing": ["Digital", "Print", "Freelance"],
      "Finance": ["Accounting", "Advising", "Insurance"],
      "Technology": ["Software", "Repair", "IT Services"],
      "Construction": ["General", "Roofing", "Electric", "Plumbing"],
      "Retail": ["Boutique", "Online", "Pop-Up"],
      "Education": ["Tutoring", "Consulting", "Online Courses"]
    };

    industrySelect.addEventListener("change", () => {
      const selected = industrySelect.value;
      subcategorySelect.innerHTML = `<option>-- Choose Subcategory --</option>`;
      if (subcategories[selected]) {
        subcategories[selected].forEach(sub => {
          const opt = document.createElement("option");
          opt.textContent = sub;
          subcategorySelect.appendChild(opt);
        });
      }
    });

    fileInput.addEventListener("change", e => {
      const reader = new FileReader();
      reader.onload = function (event) {
        const lines = event.target.result.split("\n");
        rawData = lines.map(line => line.split(","));
        headers = rawData[0];
        generateHeaderMapping();
      };
      reader.readAsText(e.target.files[0]);
    });

    function generateHeaderMapping() {
      headerMappingArea.innerHTML = "";
      headers.forEach((col, index) => {
        const label = document.createElement("label");
        label.textContent = `Column ${index + 1} (${col}):`;

        const input = document.createElement("input");
        input.setAttribute("data-index", index);
        input.placeholder = "Enter or select a header";

        label.appendChild(input);
        headerMappingArea.appendChild(label);
      });
    }

    function previewSheet() {
      const inputs = document.querySelectorAll("#headerMappingArea input");
      const newHeaders = Array.from(inputs).map(i => i.value || `Column ${i.dataset.index}`);
      const displayData = [newHeaders, ...rawData.slice(1)];

      const table = document.createElement("table");
      const thead = table.insertRow();
      newHeaders.forEach(header => {
        const th = document.createElement("th");
        th.textContent = header;
        thead.appendChild(th);
      });

      displayData.slice(1).forEach(row => {
        const tr = table.insertRow();
        newHeaders.forEach((_, i) => {
          const td = tr.insertCell();
          td.textContent = row[i] || "";
        });
      });

      tableContainer.innerHTML = "";
      tableContainer.appendChild(table);
    }

    function downloadCSV() {
      const rows = tableContainer.querySelectorAll("tr");
      let csv = Array.from(rows).map(r => Array.from(r.children).map(c => c.textContent).join(",")).join("\n");

      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "SheetPilot.csv";
      link.click();
    }

    function downloadXLSX() {
      alert("XLSX export coming in next push. For now, use CSV.");
    }
  </script>
</body>
</html>
