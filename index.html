<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SheetPilot - Step 1</title>
<style>
  body { background-color: #33658A; color: #F5F5DC; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
  h1 { font-size: 2rem; margin-bottom: 15px; }
  label { display: block; margin-top: 12px; font-weight: bold; }
  select, input[type="text"] {
    width: 100%; max-width: 400px; padding: 8px; margin-top: 6px; margin-bottom: 10px;
    border-radius: 6px; border: none; font-size: 1em; box-sizing: border-box;
    background-color: #d0e4f5; color: #000;
  }
</style>
</head>
<body>

<h1>SheetPilot </h1>

<div class="section">
  <label for="industry">Select Your Industry:</label>
  <select id="industry" onchange="updateSubcategories()">
    <option value="">-- Select Industry --</option>
  </select>

  <label for="subcategory">Select Your Subcategory:</label>
  <select id="subcategory">
    <option value="">-- Choose Subcategory --</option>
  </select>

  <label for="customIndustry">Or Manually Enter Industry:</label>
  <input type="text" id="customIndustry" placeholder="Custom Industry" />

  <label for="customSubcategory">Or Manually Enter Subcategory:</label>
  <input type="text" id="customSubcategory" placeholder="Custom Subcategory" />
</div>

<script>
// Phase 1 data: 25 industries, 3 subcategories each
const industryMap = {
  "Retail": ["Clothing Stores", "Convenience Stores", "Online Retail"],
  "Food & Beverage": ["Restaurants", "Food Trucks", "Catering Services"],
  "Beauty Services": ["Nail Salon", "Hair Salon", "Spa Services"],
  "Fitness & Wellness": ["Gyms", "Personal Trainers", "Yoga Studios"],
  "Photography & Media": ["Event Photography", "Videography", "Drone Services"],
  "Pet Services": ["Pet Grooming", "Veterinary Services", "Pet Boarding"],
  "Crafts & Makers": ["Custom Furniture", "Woodworking", "Handmade Goods"],
  "Event Planning": ["Weddings", "Corporate Events", "Party Planning"],
  "Construction": ["General Contractors", "Remodeling", "Roofing"],
  "Automotive": ["Auto Repair", "Auto Detailing", "Car Wash"],
  "Cleaning Services": ["Residential Cleaning", "Commercial Cleaning", "Carpet Cleaning"],
  "Landscaping": ["Lawn Maintenance", "Tree Services", "Irrigation"],
  "Electrical Services": ["Residential Electricians", "Commercial Electricians", "Lighting Installation"],
  "Plumbing & HVAC": ["Plumbing", "HVAC Installation", "Drain Cleaning"],
  "Painting & Drywall": ["Interior Painting", "Exterior Painting", "Drywall Repair"],
  "Transportation": ["Courier Services", "Freight Shipping", "Moving Services"],
  "Legal Services": ["Family Law", "Criminal Defense", "Estate Planning"],
  "Finance & Accounting": ["Accounting", "Tax Preparation", "Financial Planning"],
  "Marketing": ["Digital Marketing", "SEO Services", "Social Media"],
  "Real Estate": ["Residential Sales", "Commercial Leasing", "Property Management"],
  "IT Services": ["Computer Repair", "Network Setup", "Tech Consulting"],
  "Consulting": ["Business Strategy", "HR Consulting", "Operations Management"],
  "Education & Tutoring": ["Test Prep", "Subject Tutoring", "Language Instruction"],
  "Healthcare": ["Massage Therapy", "Chiropractic", "Physical Therapy"],
  "Non-Profit": ["Charitable Organizations", "Community Outreach", "Youth Programs"]
};

// Populate industry dropdown
window.onload = () => {
  const industrySelect = document.getElementById("industry");
  Object.keys(industryMap).forEach(industry => {
    const option = document.createElement("option");
    option.value = industry;
    option.textContent = industry;
    industrySelect.appendChild(option);
  });
};

// Update subcategories
function updateSubcategories() {
  const industry = document.getElementById("industry").value;
  const subcategory = document.getElementById("subcategory");
  subcategory.innerHTML = '<option value="">-- Choose Subcategory --</option>';
  if (industryMap[industry]) {
    industryMap[industry].forEach(sub => {
      const el = document.createElement("option");
      el.value = sub;
      el.textContent = sub;
      subcategory.appendChild(el);
    });
  }
}
</script>
</body>
</html>

<!-- PHASE 1: END -->
<div class="section">
  <label for="fileInput">Upload Your File:</label>
  <input type="file" id="fileInput" />
  <button id="addReplaceButton">Add/Replace</button>
  <p class="note">Use this to upload additional data to the current table.</p>
</div>

<script>
let parsedData = [];

// Trigger file parsing on upload
document.getElementById('fileInput').addEventListener('change', () => {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    const data = e.target.result;
    const workbook = XLSX.read(data, { type: 'binary' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    parsedData = XLSX.utils.sheet_to_json(sheet, { header: 1 }); // Grab ALL rows
    buildColumnMapping(parsedData[0] || []); // Use only header row for mapping
  };
  reader.readAsBinaryString(file);
});

function buildColumnMapping(headers) {
  const container = document.getElementById('columnMappingContainer');
  container.innerHTML = ''; // Clear previous mapping, if any

  headers.forEach(header => {
    const section = document.createElement('div');
    section.className = 'mapping-section';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = true;

    const columnLabel = document.createElement('div');
    columnLabel.textContent = header;

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Or enter custom label';
    input.style.width = '100%';
    input.style.marginTop = '5px';

    section.appendChild(checkbox);
    section.appendChild(columnLabel);
    section.appendChild(input);
    container.appendChild(section);
  });
}
</script>

<script>
// 1️⃣ Predefined header options for demonstration (you can customize per industry/subcategory)
const headerOptions = {
  "Retail": ["Client Name", "Purchase Date", "Amount", "Status", "Notes"],
  "Food & Beverage": ["Client Name", "Service Date", "Amount", "Payment Status", "Notes"],
  "Fitness & Wellness": ["Client Name", "Session Date", "Amount", "Payment Status", "Trainer Name"],
  // Add the rest of your industries/subcategories here!
};

let parsedData = [];

// 2️⃣ On file upload
document.getElementById('fileInput').addEventListener('change', () => {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    const data = e.target.result;
    const workbook = XLSX.read(data, { type: 'binary' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    parsedData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    buildColumnMapping(parsedData[0] || []);
  };
  reader.readAsBinaryString(file);
});

// 3️⃣ Build mapping dynamically with drop-downs
function buildColumnMapping(headers) {
  const container = document.getElementById('columnMappingContainer');
  container.innerHTML = ''; // Clear previous mapping

  const selectedIndustry = document.getElementById("industry").value || "Retail"; // fallback
  const optionsForIndustry = headerOptions[selectedIndustry] || [];

  headers.forEach(header => {
    const section = document.createElement('div');
    section.className = 'mapping-section';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = true;

    // The header itself
    const columnLabel = document.createElement('div');
    columnLabel.textContent = header;

    // Drop-down for header mapping
    const select = document.createElement('select');
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = '-- Choose Header --';
    select.appendChild(defaultOption);

    optionsForIndustry.forEach(option => {
      const opt = document.createElement('option');
      opt.value = option;
      opt.textContent = option;
      select.appendChild(opt);
    });
    select.style.width = '100%';
    select.style.marginTop = '5px';

    // Or custom input
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Or enter custom label';
    input.style.width = '100%';
    input.style.marginTop = '5px';

    section.appendChild(checkbox);
    section.appendChild(columnLabel);
    section.appendChild(select);
    section.appendChild(input);
    container.appendChild(section);
  });
}
</script>
